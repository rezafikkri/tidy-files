"use strict";const p=require("jsonwebtoken"),d=require("node:fs"),o=require("node:fs/promises"),n=require("node:path"),h="4da3a73068a119e38ebc1c663db07439897e805d37905a19aca5e431738ca855";function m(){try{const e=JSON.parse(d.readFileSync("./activation-key.json"));return p.verify(e.key,h),!0}catch{return!1}}function y(e){try{return p.verify(e,h),d.writeFileSync("./activation-key.json",JSON.stringify({key:e})),{status:"success",message:"Tidy Files App is actived."}}catch{return{status:"invalid",message:"Activation key is invalid"}}}const g=e=>d.lstatSync(e).isFile();async function f(e){d.existsSync(e)||await o.mkdir(e)}function v(e){switch(e){case".zip":case".tar":case".rar":return"archive";case".jpg":case".jpeg":case".png":return"image";default:return!1}}async function j(e){try{const i=(await o.readdir(e)).filter(t=>g(n.join(e,t)));if(i.length<=0)return{status:"fail",message:"Folder is empty."};for(const t of i){const l=v(n.extname(t));l&&(l==="archive"&&(await f(n.join(e,"archives")),await o.rename(n.join(e,t),n.join(e,"archives",t))),l==="image"&&(await f(n.join(e,"images")),await o.rename(n.join(e,t),n.join(e,"images",t))))}return{status:"success"}}catch(a){console.log(a)}}const{app:s,BrowserWindow:c,ipcMain:u,dialog:_}=require("electron"),r=require("node:path");require("electron-squirrel-startup")&&s.quit();const w=()=>{const e=new c({width:600,height:300,webPreferences:{preload:r.join(__dirname,"preload.js")}});if(e.setMenuBarVisibility(!1),e.loadFile(r.join(__dirname,"../renderer/main_window/index.html")),!m()){const i=new c({parent:e,modal:!0,width:400,height:200,minimizable:!1,webPreferences:{preload:r.join(__dirname,"aw-preload.js")}});i.webContents.openDevTools(),i.setMenuBarVisibility(!1),i.loadFile(r.join(__dirname,"../renderer/main_window/activation_window.html")),i.on("close",()=>{e.close()})}};s.whenReady().then(()=>{u.handle("chooseFolder",()=>_.showOpenDialog({title:"Choose folder to tiding",properties:["openDirectory"]})),u.handle("tidingFiles",(a,i)=>j(i)),m()||u.handle("active",(a,i)=>{const t=y(i);return t.status==="success"&&c.getFocusedWindow().hide(),t}),w(),s.on("activate",()=>{c.getAllWindows().length===0&&w()})});s.on("window-all-closed",()=>{process.platform!=="darwin"&&s.quit()});
